#!/usr/bin/env bash
##Created by Edward "edge226" Tunnah.

## defines the usage of the program.
usage="
Name: 				lucid-build
  
Description:    			lucid-build compiles all PKGBUILD's recursively 
					within the working directory. It will have options to
					modify where it starts searching and what
					architecture you would like to build within that
					working directory.
					
					Currently you can only use one architecture at
					a time but that will change.

<<<<<<< HEAD
Usage:				lucid-build (Options) [-d] <location>
=======
Usage:					lucid-build (Options)
>>>>>>> 32855546c9002d22e251a9b670a8f14d9d872dd9

Options: 		

	-h or --help 			You're reading it.
	
	-6				Compiles x86_64 packages.
	-64				^    ^    ^    ^    ^
	
	-3				Compiles i686 packages.
	-32				^    ^    ^    ^    ^
	
	-m				Compiles multilib packages.
	-multilib			^    ^    ^    ^    ^    ^
					
	-d				Specifies the directory to start searching for
					PKGBUILD files.
Examples:		
	The following examples will compile packages for the appropriate 
	architecture starting in the current working directory.
	
<<<<<<< HEAD
	lb -6
	lb -3
	lb -m
	
	The following examples will compile packages for the appropriate
	architecture at the location you point it at.
	
	lb -6d /var/abs/core/pacman
	lb -3d /var/abs/core/pacman
	lb -md /var/abs/multilib/zsnes"
=======
	lb -6 /var/abs/core/
	lb -3 /var/abs/core/
	lb -m /var/abs/core/"
>>>>>>> 32855546c9002d22e251a9b670a8f14d9d872dd9
	
findpkgbuild() {
	## This stuff just finds pkgbuilds and then runs an inputted command

<<<<<<< HEAD
=======
	if [ "$1" = "" ]; then
		local build="unstable-x86_64-build"
	elif [ ! "$1" = "" ]; then
		local build="$1"
		echo "$build"
	fi
	if [ "$2" = "" ]; then
		local dir="./"
		echo "$dir"
	elif [ ! "$2" = "" ]; then
		local dir="$2"
		echo "$dir"
	fi

>>>>>>> 32855546c9002d22e251a9b670a8f14d9d872dd9
	find "$dir" -name PKGBUILD -type f -print0 -exec "$build" \;
}

## The main stuff.

<<<<<<< HEAD
OPTIND=1 ## make sure the optargs are reset for getopts
build="" ## makes sure there is a default set for build.
dir=""	 ## makes sure there is a default set for dir.

## This case statement sets the build parameters of the program for
## which architecture to use. 
while getopts "6d:3d:md:*:" opt; do
	case "$opt" in
		( d )	dir=$OPTARG;;
		( 6 )	build="unstable-x86_64-build"
				printf "The build has been set to 64 bit.\n";;
		( 3 )	build="unstable-i686-build"
				printf "The build has been set to 32 bit.\n";;
		( m )	build="unstable-multilib-build"
				printf "The build has been set to multilib.\n";;
		( * )	echo "$usage";;
	esac
done
if [ "$build" = "" ]; then
	local build="unstable-x86_64-build"
	printf "The build has been set to 64 bit as default.\n"
else
	printf "The build environment has been set to: $build\n"
fi
if [ "$dir" = "" ]; then
	local dir="./"
	printf "Finding packagebuilds in "pwd" directory.\n"
else 
	printf "Finding packagebuilds in $dir directory.\n"
fi

findpkgbuild "$build" "$dir"
=======
case "$@" in
	( -6 | -64 ) 			build="unstable-x86_64-build"; findpkgbuild "$build";;
	( -3 | -32 ) 			build="unstable-i686-build"; findpkgbuild "$build";;
	( -m | --multilib ) 		build="unstable-multilib-build"; findpkgbuild "$build";;
	( -h | --help )			echo "$usage";;
	*) 				build=""; findpkgbuild "$build";;
esac
>>>>>>> 32855546c9002d22e251a9b670a8f14d9d872dd9
