#!/usr/bin/env bash
##Created by Edward "edge226" Tunnah.

## defines the usage of the program.
usage="
Name: 				lucid-build
  
Description:    			lucid-build compiles all PKGBUILD's recursively 
					within the working directory. It has options to
					modify where it starts searching and what
					architecture you would like to build within that
					working directory.
					
					Currently you can only use one architecture at
					a time but that will change.

Usage:					lucid-build (Options)

Options: 		

	-h or --help 			You're reading it.
	
	-6				Compiles x86_64 packages.
	-64				^    ^    ^    ^    ^
	
	-3				Compiles i686 packages.
	-32				^    ^    ^    ^    ^
	
	-m				Compiles multilib packages.
	-multilib			^    ^    ^    ^    ^    ^
					
Examples:		
	
	lb -6 /var/abs/core/
	lb -3 /var/abs/core/
	lb -m /var/abs/core/"
	
findpkgbuild() {
	## This stuff just finds pkgbuilds and then runs an inputted command

	if [ "$1" = "" ]; then
		local build="unstable-x86_64-build"
	elif [ ! "$1" = "" ]; then
		local build="$1"
		echo "$build"
	fi
	if [ "$2" = "" ]; then
		local dir="./"
		echo "$dir"
	elif [ ! "$2" = "" ]; then
		local dir="$2"
		echo "$dir"
	fi

	find "$dir" -name PKGBUILD -type f -print0 -exec "$build" \;
}

## The main stuff.

case "$@" in
	( -6 | -64 ) 			build="unstable-x86_64-build"; findpkgbuild "$build";;
	( -3 | -32 ) 			build="unstable-i686-build"; findpkgbuild "$build";;
	( -m | --multilib ) 		build="unstable-multilib-build"; findpkgbuild "$build";;
	( -h | --help )			echo "$usage";;
	*) 				build=""; findpkgbuild "$build";;
esac
